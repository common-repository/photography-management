GLOB_max=parseInt(GLOB_max);GLOB_clients_num=parseInt(GLOB_clients_num);var app=angular.module("Project",[]);var file_frame;app.constant("projects",GLOB_projects);var Main=function(){function Main(scope,projects){this.scope=scope;this.projects=[];this.usePwd=false;console.log("projects",projects);if(projects[0]!=="")this.projects=projects;for(var i in this.projects){if(this.projects[i].gallery===undefined)this.projects[i].gallery=[]}}Main.prototype.getThumbUrl=function(url){console.log(url)};Main.prototype.addProject=function(){if(this.projects.length>=GLOB_max){jQuery("a.thickbox").click()}else this.projects.push(new Project)};Main.prototype.removeProject=function(projI){var confirm=window.confirm("Are you sure? Note that uploaded images will still be in the library");if(!confirm)return;this.projects.splice(projI,1)};Main.prototype.removeImage=function(projI,galleryI){this.projects[projI].gallery.splice(galleryI,1)};Main.prototype.emptyGallery=function(i){this.projects[i].gallery=[]};Main.$inject=["$scope","projects"];return Main}();app.controller("Main",Main);var HACK_attr=null;app.directive("uploadGallery",function(){return{restrict:"A",link:function(scope,elem,attr){elem.bind("click",function(){var ctrl=scope.$parent.ctrl;var index=attr.uploadGallery;HACK_attr=attr;if(file_frame){file_frame.open();return}file_frame=wp.media.frames.file_frame=wp.media({title:elem.data("uploader_title"),button:{text:elem.data("uploader_button_text")},multiple:true});file_frame.on("select",function(){var attachment=file_frame.state().get("selection").first().toJSON();var attachment2=file_frame.state().get("selection").toJSON();console.log(attachment2);var i=ctrl.projects[index].gallery.length;jQuery("#cc-image-spinner-"+HACK_attr.uploadGallery).css("display","inline-block");attachment2.forEach(function(attach){jQuery.post("admin-ajax.php",{action:"cc_photo_manage_get_attachment",attachID:attach.id},function(res){console.log("ATTR",HACK_attr);res.id=attach.id;ctrl.projects[HACK_attr.uploadGallery].gallery.push(res);console.log("insert new thumb",res);ctrl.scope.$apply(function(){console.log("applied");jQuery("#cc-image-spinner-"+HACK_attr.uploadGallery).hide()})});i++})});file_frame.open()})}}});app.filter("thumb",function(){return function(input,total){return input}});var Project=function(){function Project(){this.gallery=[];this.title="";this.gallery=[]}return Project}();var url="http://swp.codeneric.com";function checkReview(){if(!jQuery.trim(jQuery("#cc-username").val()))return;jQuery("#cc-msg-box").remove();var msgBox=jQuery('<div id="cc-msg-box"></div>');msgBox.css({"margin-left":0,"margin-top":"1em"});jQuery("#cc-premium-spinner").css("display","inline-block");jQuery.get(url+"/check-review",{username:jQuery("#cc-username").val(),id:GLOB_id},function(res){console.log("Reviewed:",res);if(res==="ok"){jQuery.post("admin-ajax.php",{action:"cc_photo_manage_prem"},function(res){msgBox.addClass("updated").html("Congratulations!</br> Close all popups and enjoy your premium version.");GLOB_max=1e4;jQuery("#cc-premium-spinner").hide();msgBox.insertAfter("#cc-premium-spinner");jQuery("#cc-go-premium").attr("disabled",true);jQuery("#cc-username").attr("disabled",true)})}else{if(res==="already-reviewed"){msgBox.addClass("error").html('This review does not seem to be yours. </br> If you think that this is not true, contact us: <a href="mailto:contact@codeneric.com">contact@codeneric.com</a>')}if(res==="no-review-found"){msgBox.addClass("error").html("There is no review by <strong>"+jQuery("#cc-username").val()+'</strong>.</br> If you think that this is not true, contact us: <a href="mailto:contact@codeneric.com">contact@codeneric.com</a>')}jQuery("#cc-premium-spinner").hide();msgBox.insertAfter("#cc-premium-spinner")}})}var chill_request_time=0;jQuery("#cc-username").on("input",function(){clearTimeout(chill_request_time);jQuery("#cc-go-premium").attr("disabled",true);jQuery("#cc-premium-spinner").css("display","inline-block");chill_request_time=setTimeout(function(){console.log("Uname changed!");var username=jQuery("#cc-username").val();var temp=username.match(/\((.*)\)/);if(temp!==null&&temp.length===2){username=temp[1]}jQuery.get(url+"/register-username",{username:username,id:GLOB_id},function(res){console.log("Register-Username:",res);jQuery("#cc-go-premium").attr("disabled",false);jQuery("#cc-premium-spinner").hide()})},1e3)});jQuery(document).ready(function(){if(jQuery("#cc-full-name").val()===""&&GLOB_clients_num>=2&&GLOB_max<100){jQuery("#premium-message").show();jQuery("a.thickbox").click();jQuery("#poststuff input").attr("disabled",true)}});